<% @title = "Public authority - " + h(@public_body.name) %>

<h1><%=@title%></h1>

<p>
<% for column in PublicBody.content_columns %>
  <b><%= column.human_name %>:</b> <%=h @public_body.send(column.name) %>
  <br/>
<% end %>
<b>Calculated home page:</b> <%= link_to(h(@public_body.calculated_home_page), @public_body.calculated_home_page) %>
<br/><b>Tags:</b> <%=h @public_body.tag_string %>
<br/>
</p>

<p>
    <%= link_to 'Public page', main_url(public_body_url(@public_body)) %>
    | <%= link_to 'Edit', '../edit/' + @public_body.id.to_s %>
</p>

<h2>History</h2>
<table border="1">
<tr>
<% 
    history_columns = PublicBody.content_columns
    history_columns.delete_if {|c| ['created_at', 'updated_at'].include?(c.name)}
    for column in history_columns %>
  <th><%= column.human_name %></th>
<% end %>
<th>Updated at</th>
</tr>
<% for historic_public_body in @public_body.versions.reverse %>
      <tr class="<%= cycle('odd', 'even') %>">
    <% for column in history_columns %>
      <% # Highlight entries which have changed since previous version
        changed = (not ['version', 'last_edit_editor', 'last_edit_comment'].include?(column.name)) && ((historic_public_body.send(column.name) != @public_body.versions[historic_public_body.version - 2].send(column.name)) || (historic_public_body.version == 1)) %>
      <td <%= changed ? ' class="entry_changed" ': '' %> >
      <%=h historic_public_body.send(column.name) %>
      </td>
    <% end %>
      <td><%=h historic_public_body.updated_at %></td>
    </tr>
<% end %>
</table>

<h2>Requests</h2>
<%= render :partial => 'admin_request/some_requests', :locals => { :info_requests => @public_body.info_requests } %>

